openapi: 3.1.0
info:
  title: BudgetBuddy API
  version: "1"
  description: |
    Operational header behavior: responses include `X-Request-Id`.
    If request provides `X-Request-Id`, the API echoes it; otherwise it generates one.
servers:
- url: /api
security:
- BearerAuth: []

paths:
  /auth/register:
    post:
      security: []
      summary: Register a new user
      requestBody:
        required: true
        content:
          application/vnd.budgetbuddy.v1+json:
            schema:
              $ref: "#/components/schemas/RegisterRequest"
      responses:
        "201":
          description: Created
          headers:
            X-Request-Id:
              $ref: "#/components/headers/X-Request-Id"
          content:
            application/vnd.budgetbuddy.v1+json:
              schema:
                $ref: "#/components/schemas/AuthResponse"
        "400":
          description: Invalid request
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "409":
          description: Username already exists
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "406":
          description: Not Acceptable
          headers:
            X-Request-Id:
              $ref: "#/components/headers/X-Request-Id"
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
  /auth/login:
    post:
      security: []
      summary: Login a user
      requestBody:
        required: true
        content:
          application/vnd.budgetbuddy.v1+json:
            schema:
              $ref: "#/components/schemas/LoginRequest"
      responses:
        "200":
          description: OK
          content:
            application/vnd.budgetbuddy.v1+json:
              schema:
                $ref: "#/components/schemas/AuthResponse"
        "400":
          description: Invalid request
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "401":
          description: Unauthorized
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "406":
          description: Not Acceptable
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
  /auth/refresh:
    post:
      security: []
      summary: Refresh token
      requestBody:
        required: true
        content:
          application/vnd.budgetbuddy.v1+json:
            schema:
              $ref: "#/components/schemas/RefreshRequest"
      responses:
        "200":
          description: OK
          content:
            application/vnd.budgetbuddy.v1+json:
              schema:
                $ref: "#/components/schemas/AuthResponse"
        "400":
          description: Invalid request
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "401":
          description: Unauthorized
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "403":
          description: Forbidden
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "406":
          description: Not Acceptable
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
  /auth/logout:
    post:
      summary: Logout (revoke refresh token)
      requestBody:
        required: true
        content:
          application/vnd.budgetbuddy.v1+json:
            schema:
              $ref: "#/components/schemas/RefreshRequest"
      responses:
        "204":
          description: No Content
        "400":
          description: Invalid request
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "401":
          description: Unauthorized
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "403":
          description: Forbidden
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "406":
          description: Not Acceptable
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
  /accounts:
    get:
      summary: List accounts
      description: |
        Cursor pagination uses an opaque `base64url(JSON)` token.
        Ordering is deterministic by `created_at DESC, id DESC`, and `next_cursor` is derived from that same sort key.
        For stable datasets, paging is deterministic with no overlaps or skips; terminal page returns `next_cursor: null`.
        Under concurrent mutations, pagination is best-effort and does not guarantee snapshot semantics.
      parameters:
      - name: include_archived
        in: query
        required: false
        schema:
          type: boolean
          default: false
      - name: cursor
        in: query
        required: false
        description: Opaque `base64url(JSON)` token built from `created_at` and `id` of the last item in the previous page.
        schema:
          type: string
      - name: limit
        in: query
        required: false
        schema:
          type: integer
          default: 20
          minimum: 1
          maximum: 100
      responses:
        "200":
          description: OK
          headers:
            X-Request-Id:
              $ref: "#/components/headers/X-Request-Id"
          content:
            application/vnd.budgetbuddy.v1+json:
              schema:
                type: object
                required: [ items, next_cursor ]
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/Account"
                  next_cursor:
                    type: [ string, "null" ]
        "400":
          description: Invalid cursor
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "401":
          description: Unauthorized
          headers:
            X-Request-Id:
              $ref: "#/components/headers/X-Request-Id"
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "406":
          description: Not Acceptable
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"

    post:
      summary: Create account
      requestBody:
        required: true
        content:
          application/vnd.budgetbuddy.v1+json:
            schema:
              $ref: "#/components/schemas/AccountCreate"
      responses:
        "201":
          description: Created
          content:
            application/vnd.budgetbuddy.v1+json:
              schema:
                $ref: "#/components/schemas/Account"
        "400":
          description: Invalid request
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "401":
          description: Unauthorized
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "409":
          description: Account name already exists
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "406":
          description: Not Acceptable
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
  /accounts/{account_id}:
    parameters:
    - name: account_id
      in: path
      required: true
      schema:
        type: string
        format: uuid
    get:
      summary: Get account
      responses:
        "200":
          description: OK
          content:
            application/vnd.budgetbuddy.v1+json:
              schema:
                $ref: "#/components/schemas/Account"
        "400":
          description: Invalid request
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "401":
          description: Unauthorized
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "403":
          description: Forbidden (resource is not owned by authenticated user)
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "406":
          description: Not Acceptable
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
    patch:
      summary: Update account
      requestBody:
        required: true
        content:
          application/vnd.budgetbuddy.v1+json:
            schema:
              $ref: "#/components/schemas/AccountUpdate"
      responses:
        "200":
          description: OK
          content:
            application/vnd.budgetbuddy.v1+json:
              schema:
                $ref: "#/components/schemas/Account"
        "400":
          description: Invalid request
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "401":
          description: Unauthorized
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "403":
          description: Forbidden (resource is not owned by authenticated user)
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "409":
          description: Account name already exists
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "406":
          description: Not Acceptable
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
    delete:
      summary: Archive account
      responses:
        "204":
          description: No Content
        "400":
          description: Invalid request
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "401":
          description: Unauthorized
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "403":
          description: Forbidden (resource is not owned by authenticated user)
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "406":
          description: Not Acceptable
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
  /categories:
    get:
      summary: List categories
      description: |
        Cursor pagination uses an opaque `base64url(JSON)` token.
        Ordering is deterministic by `created_at DESC, id DESC`, and `next_cursor` is derived from that same sort key.
        For stable datasets, paging is deterministic with no overlaps or skips; terminal page returns `next_cursor: null`.
        Under concurrent mutations, pagination is best-effort and does not guarantee snapshot semantics.
      parameters:
      - name: include_archived
        in: query
        required: false
        schema:
          type: boolean
          default: false
      - name: type
        in: query
        required: false
        schema:
          type: string
          enum: [ income, expense ]
      - name: cursor
        in: query
        required: false
        description: Opaque `base64url(JSON)` token built from `created_at` and `id` of the last item in the previous page.
        schema:
          type: string
      - name: limit
        in: query
        required: false
        schema:
          type: integer
          default: 20
          minimum: 1
          maximum: 100
      responses:
        "200":
          description: OK
          headers:
            X-Request-Id:
              $ref: "#/components/headers/X-Request-Id"
          content:
            application/vnd.budgetbuddy.v1+json:
              schema:
                type: object
                required: [ items, next_cursor ]
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/Category"
                  next_cursor:
                    type: [ string, "null" ]
        "400":
          description: Invalid cursor
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "401":
          description: Unauthorized
          headers:
            X-Request-Id:
              $ref: "#/components/headers/X-Request-Id"
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "406":
          description: Not Acceptable
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"

    post:
      summary: Create category
      requestBody:
        required: true
        content:
          application/vnd.budgetbuddy.v1+json:
            schema:
              $ref: "#/components/schemas/CategoryCreate"
      responses:
        "201":
          description: Created
          content:
            application/vnd.budgetbuddy.v1+json:
              schema:
                $ref: "#/components/schemas/Category"
        "400":
          description: Invalid request
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "401":
          description: Unauthorized
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "409":
          description: Category name already exists for this type
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "406":
          description: Not Acceptable
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"

  /categories/{category_id}:
    parameters:
    - name: category_id
      in: path
      required: true
      schema:
        type: string
        format: uuid

    get:
      summary: Get category
      responses:
        "200":
          description: OK
          content:
            application/vnd.budgetbuddy.v1+json:
              schema:
                $ref: "#/components/schemas/Category"
        "400":
          description: Invalid request
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "401":
          description: Unauthorized
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "403":
          description: Forbidden (resource is not owned by authenticated user)
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "406":
          description: Not Acceptable
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"

    patch:
      summary: Update category
      requestBody:
        required: true
        content:
          application/vnd.budgetbuddy.v1+json:
            schema:
              $ref: "#/components/schemas/CategoryUpdate"
      responses:
        "200":
          description: OK
          content:
            application/vnd.budgetbuddy.v1+json:
              schema:
                $ref: "#/components/schemas/Category"
        "400":
          description: Invalid request
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "401":
          description: Unauthorized
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "403":
          description: Forbidden (resource is not owned by authenticated user)
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "409":
          description: Category name already exists for this type
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "406":
          description: Not Acceptable
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"

    delete:
      summary: Archive category
      responses:
        "204":
          description: No Content
        "400":
          description: Invalid request
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "401":
          description: Unauthorized
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "403":
          description: Forbidden (resource is not owned by authenticated user)
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "406":
          description: Not Acceptable
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
  /transactions:
    get:
      summary: List transactions (ordered by date desc, then created_at desc)
      description: |
        Filters `type`, `account_id`, `category_id`, `from`, `to`, and `include_archived` are combined as AND predicates.
        Cursor pagination uses an opaque `base64url(JSON)` token and deterministic ordering by `date DESC, created_at DESC, id DESC`.
        For stable datasets, paging is deterministic with no overlaps or skips; terminal page returns `next_cursor: null`.
        Under concurrent mutations, pagination is best-effort and does not guarantee snapshot semantics.
        Compatibility policy: `GET /transactions` accepts legacy cursors containing only `date` and `id` (without `created_at`) for backward compatibility in API v1.
        `GET /accounts` and `GET /categories` require current cursor fields only; malformed or unsupported cursor shapes return canonical `400 Invalid cursor`.
      parameters:
      - name: include_archived
        in: query
        required: false
        schema:
          type: boolean
          default: false
      - name: type
        in: query
        required: false
        schema:
          type: string
          enum: [ income, expense ]
      - name: account_id
        in: query
        required: false
        schema:
          type: string
          format: uuid
      - name: category_id
        in: query
        required: false
        schema:
          type: string
          format: uuid
      - name: from
        in: query
        required: false
        schema:
          type: string
          format: date
      - name: to
        in: query
        required: false
        schema:
          type: string
          format: date
      - name: cursor
        in: query
        required: false
        description: Opaque `base64url(JSON)` token built from `date`, `created_at`, and `id` of the last item in the previous page.
        schema:
          type: string
      - name: limit
        in: query
        required: false
        schema:
          type: integer
          default: 20
          minimum: 1
          maximum: 100
      responses:
        "200":
          description: OK
          headers:
            X-Request-Id:
              $ref: "#/components/headers/X-Request-Id"
          content:
            application/vnd.budgetbuddy.v1+json:
              schema:
                type: object
                required: [ items, next_cursor ]
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/Transaction"
                  next_cursor:
                    type: [ string, "null" ]

        "400":
          description: Invalid cursor or invalid date range (from must be <= to)
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "401":
          description: Unauthorized
          headers:
            X-Request-Id:
              $ref: "#/components/headers/X-Request-Id"
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "406":
          description: Not Acceptable
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"

    post:
      summary: Create transaction
      requestBody:
        required: true
        content:
          application/vnd.budgetbuddy.v1+json:
            schema:
              $ref: "#/components/schemas/TransactionCreate"
      responses:
        "201":
          description: Created
          content:
            application/vnd.budgetbuddy.v1+json:
              schema:
                $ref: "#/components/schemas/Transaction"
        "400":
          description: Invalid request
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "401":
          description: Unauthorized
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "403":
          description: Forbidden (resource is not owned by authenticated user)
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "409":
          description: Business rule conflict (e.g. account archived, category archived, type mismatch)
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "406":
          description: Not Acceptable
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"

  /transactions/{transaction_id}:
    parameters:
    - name: transaction_id
      in: path
      required: true
      schema:
        type: string
        format: uuid

    get:
      summary: Get transaction
      responses:
        "200":
          description: OK
          content:
            application/vnd.budgetbuddy.v1+json:
              schema:
                $ref: "#/components/schemas/Transaction"
        "400":
          description: Invalid request
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "401":
          description: Unauthorized
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "403":
          description: Forbidden (resource is not owned by authenticated user)
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "406":
          description: Not Acceptable
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"

    patch:
      summary: Update or restore transaction
      requestBody:
        required: true
        content:
          application/vnd.budgetbuddy.v1+json:
            schema:
              $ref: "#/components/schemas/TransactionUpdate"
      responses:
        "200":
          description: Updated (or restored when archived_at=null)
          content:
            application/vnd.budgetbuddy.v1+json:
              schema:
                $ref: "#/components/schemas/Transaction"
        "400":
          description: Invalid request
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "401":
          description: Unauthorized
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "403":
          description: Forbidden (resource is not owned by authenticated user)
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "409":
          description: Business rule conflict (e.g. account archived, category archived, type mismatch)
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "406":
          description: Not Acceptable
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"

    delete:
      summary: Archive transaction
      responses:
        "204":
          description: No Content
        "400":
          description: Invalid request
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "401":
          description: Unauthorized
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "403":
          description: Forbidden (resource is not owned by authenticated user)
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "406":
          description: Not Acceptable
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
  /analytics/by-month:
    get:
      summary: Analytics totals by month (income and expense)
      parameters:
      - name: from
        in: query
        required: true
        schema:
          type: string
          format: date
      - name: to
        in: query
        required: true
        schema:
          type: string
          format: date
      responses:
        "200":
          description: OK
          content:
            application/vnd.budgetbuddy.v1+json:
              schema:
                $ref: "#/components/schemas/AnalyticsByMonthResponse"
        "400":
          description: Invalid request
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "401":
          description: Unauthorized
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "406":
          description: Not Acceptable
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"

  /analytics/by-category:
    get:
      summary: Analytics totals by category (income and expense)
      parameters:
      - name: from
        in: query
        required: true
        schema:
          type: string
          format: date
      - name: to
        in: query
        required: true
        schema:
          type: string
          format: date
      responses:
        "200":
          description: OK
          content:
            application/vnd.budgetbuddy.v1+json:
              schema:
                $ref: "#/components/schemas/AnalyticsByCategoryResponse"
        "400":
          description: Invalid request
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "401":
          description: Unauthorized
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"
        "406":
          description: Not Acceptable
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ProblemDetails"

components:
  headers:
    X-Request-Id:
      description: Correlation id for tracing requests. Propagated when provided by client, generated otherwise.
      schema:
        type: string
  x-problem-details-catalog:
  - type: https://api.budgetbuddy.dev/problems/unauthorized
    title: Unauthorized
    status: 401
  - type: https://api.budgetbuddy.dev/problems/forbidden
    title: Forbidden
    status: 403
  - type: https://api.budgetbuddy.dev/problems/not-acceptable
    title: Not Acceptable
    status: 406
  - type: https://api.budgetbuddy.dev/problems/invalid-cursor
    title: Invalid cursor
    status: 400
  - type: https://api.budgetbuddy.dev/problems/invalid-date-range
    title: Invalid date range
    status: 400
  - type: https://api.budgetbuddy.dev/problems/refresh-revoked
    title: Refresh token revoked
    status: 403
  - type: https://api.budgetbuddy.dev/problems/refresh-reuse-detected
    title: Refresh token reuse detected
    status: 403
  - type: https://api.budgetbuddy.dev/problems/account-archived
    title: Account is archived
    status: 409
  - type: https://api.budgetbuddy.dev/problems/category-archived
    title: Category is archived
    status: 409
  - type: https://api.budgetbuddy.dev/problems/category-type-mismatch
    title: Category type mismatch
    status: 409
  - type: https://api.budgetbuddy.dev/problems/money-amount-not-integer
    title: Money amount must be an integer
    status: 400
  - type: https://api.budgetbuddy.dev/problems/money-amount-out-of-range
    title: Money amount is out of safe range
    status: 400
  - type: https://api.budgetbuddy.dev/problems/money-amount-sign-invalid
    title: Money amount sign is invalid
    status: 400
  - type: https://api.budgetbuddy.dev/problems/money-currency-mismatch
    title: Money currency mismatch
    status: 400
  schemas:
    ProblemDetails:
      type: object
      required: [ type, title, status ]
      properties:
        type:
          type: string
          format: uri
        title:
          type: string
        status:
          type: integer
        detail:
          type: string
        instance:
          type: string
          format: uri
    User:
      type: object
      required: [ id, username, currency_code ]
      properties:
        id:
          type: string
          format: uuid
        username:
          type: string
          pattern: '^[a-zA-Z0-9_]{3,20}$'
        currency_code:
          type: string
          enum: [ USD, COP, EUR, MXN ]
    RegisterRequest:
      type: object
      required: [ username, password, currency_code ]
      properties:
        username:
          type: string
          pattern: '^[a-zA-Z0-9_]{3,20}$'
        password:
          type: string
          minLength: 12
        currency_code:
          type: string
          enum: [ USD, COP, EUR, MXN ]
    AuthResponse:
      type: object
      required: [ user, access_token, refresh_token, access_token_expires_in ]
      properties:
        user:
          $ref: "#/components/schemas/User"
        access_token:
          type: string
        refresh_token:
          type: string
        access_token_expires_in:
          type: integer
          description: Seconds until access token expiration
    LoginRequest:
      type: object
      required: [ username, password ]
      properties:
        username:
          type: string
          pattern: '^[a-zA-Z0-9_]{3,20}$'
        password:
          type: string
          minLength: 12
    RefreshRequest:
      type: object
      required: [ refresh_token ]
      properties:
        refresh_token:
          type: string
    Account:
      type: object
      required: [ id, name, type, initial_balance_cents, archived_at ]
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          minLength: 1
        type:
          type: string
          enum: [ cash, debit, credit, bank ]
        initial_balance_cents:
          type: integer
          description: Signed integer amount in cents
        note:
          type: string
        archived_at:
          type: [ string, "null" ]
          format: date-time
    AccountCreate:
      type: object
      required: [ name, type, initial_balance_cents ]
      properties:
        name:
          type: string
          minLength: 1
        type:
          type: string
          enum: [ cash, debit, credit, bank ]
        initial_balance_cents:
          type: integer
          description: Signed integer amount in cents
        note:
          type: string
    AccountUpdate:
      type: object
      properties:
        name:
          type: string
          minLength: 1
        type:
          type: string
          enum: [ cash, debit, credit, bank ]
        initial_balance_cents:
          type: integer
          description: Signed integer amount in cents
        note:
          type: string
        archived_at:
          type: [ string, "null" ]
          format: date-time
    Category:
      type: object
      required: [ id, name, type, archived_at ]
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          minLength: 1
        type:
          type: string
          enum: [ income, expense ]
        note:
          type: string
        archived_at:
          type: [ string, "null" ]
          format: date-time
    CategoryCreate:
      type: object
      required: [ name, type ]
      properties:
        name:
          type: string
          minLength: 1
        type:
          type: string
          enum: [ income, expense ]
        note:
          type: string
    CategoryUpdate:
      type: object
      properties:
        name:
          type: string
          minLength: 1
        note:
          type: string
        archived_at:
          type: [ string, "null" ]
          format: date-time
    Transaction:
      type: object
      required: [ id, type, account_id, category_id, amount_cents, date, archived_at, created_at, updated_at ]
      properties:
        id:
          type: string
          format: uuid
        type:
          type: string
          enum: [ income, expense ]
        account_id:
          type: string
          format: uuid
        category_id:
          type: string
          format: uuid
        amount_cents:
          type: integer
          minimum: 1
          maximum: 999999999999
        date:
          type: string
          format: date
        merchant:
          type: [ string, "null" ]
        note:
          type: [ string, "null" ]
        archived_at:
          type: [ string, "null" ]
          format: date-time
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    TransactionCreate:
      type: object
      required: [ type, account_id, category_id, amount_cents, date ]
      properties:
        type:
          type: string
          enum: [ income, expense ]
        account_id:
          type: string
          format: uuid
        category_id:
          type: string
          format: uuid
        amount_cents:
          type: integer
          minimum: 1
          maximum: 999999999999
        date:
          type: string
          format: date
        merchant:
          type: string
        note:
          type: string

    TransactionUpdate:
      type: object
      properties:
        type:
          type: string
          enum: [ income, expense ]
        account_id:
          type: string
          format: uuid
        category_id:
          type: string
          format: uuid
        amount_cents:
          type: integer
          minimum: 1
          maximum: 999999999999
        date:
          type: string
          format: date
        merchant:
          type: [ string, "null" ]
        note:
          type: [ string, "null" ]
        archived_at:
          type: [ string, "null" ]
          format: date-time
    AnalyticsByMonthItem:
      type: object
      required: [ month, income_total_cents, expense_total_cents ]
      properties:
        month:
          type: string
          pattern: '^\d{4}-\d{2}$'
        income_total_cents:
          type: integer
        expense_total_cents:
          type: integer

    AnalyticsByMonthResponse:
      type: object
      required: [ items ]
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/AnalyticsByMonthItem"

    AnalyticsByCategoryItem:
      type: object
      required: [ category_id, category_name, income_total_cents, expense_total_cents ]
      properties:
        category_id:
          type: string
          format: uuid
        category_name:
          type: string
        income_total_cents:
          type: integer
        expense_total_cents:
          type: integer

    AnalyticsByCategoryResponse:
      type: object
      required: [ items ]
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/AnalyticsByCategoryItem"

  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT


